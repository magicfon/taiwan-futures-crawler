name: æ¯é€±è³‡æ–™å ±å‘Š

on:
  schedule:
    # æ¯é€±æ—¥å°åŒ—æ™‚é–“ 18:00 åŸ·è¡Œ (UTC 10:00)
    - cron: '0 10 * * 0'
  workflow_dispatch:

jobs:
  weekly-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: çµ±è¨ˆè³‡æ–™æª”æ¡ˆ
      run: |
        echo "=== æœ¬é€±å°æœŸæ‰€è³‡æ–™çˆ¬å–å ±å‘Š ===" > weekly_report.txt
        echo "ç”Ÿæˆæ™‚é–“: $(date '+%Y-%m-%d %H:%M:%S')" >> weekly_report.txt
        echo "" >> weekly_report.txt
        
        if [ -d "output" ]; then
          echo "ðŸ“Š è³‡æ–™æª”æ¡ˆçµ±è¨ˆ:" >> weekly_report.txt
          echo "CSVæª”æ¡ˆæ•¸é‡: $(find output -name "*.csv" | wc -l)" >> weekly_report.txt
          echo "Excelæª”æ¡ˆæ•¸é‡: $(find output -name "*.xlsx" | wc -l)" >> weekly_report.txt
          echo "" >> weekly_report.txt
          
          echo "ðŸ“ æœ€æ–°æª”æ¡ˆ:" >> weekly_report.txt
          ls -lt output/*.csv 2>/dev/null | head -5 >> weekly_report.txt || echo "ç„¡CSVæª”æ¡ˆ" >> weekly_report.txt
          echo "" >> weekly_report.txt
          
          echo "ðŸ’¾ è³‡æ–™å¤¾å¤§å°:" >> weekly_report.txt
          du -sh output/ >> weekly_report.txt
        else
          echo "âŒ è¼¸å‡ºç›®éŒ„ä¸å­˜åœ¨" >> weekly_report.txt
        fi
        
        echo "" >> weekly_report.txt
        echo "ðŸ¤– æ­¤å ±å‘Šç”±GitHub Actionsè‡ªå‹•ç”Ÿæˆ" >> weekly_report.txt
        
    - name: é¡¯ç¤ºå ±å‘Š
      run: cat weekly_report.txt
      
    - name: ä¸Šå‚³å ±å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: weekly-report-${{ github.run_number }}
        path: weekly_report.txt
        retention-days: 90 