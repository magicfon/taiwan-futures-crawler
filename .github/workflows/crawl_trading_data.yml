name: ğŸš€ å°æœŸæ‰€äº¤æ˜“é‡è³‡æ–™çˆ¬å–

on:
  schedule:
    # å°ç£æ™‚é–“ä¸‹åˆ2é» = UTCæ™‚é–“ä¸Šåˆ6é» (UTC+8)
    - cron: '0 6 * * 1-5'  # é€±ä¸€åˆ°é€±äº” UTC 06:00 (å°ç£æ™‚é–“ 14:00)
  workflow_dispatch:  # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  crawl-trading-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ”„ æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
    
    - name: ğŸ è¨­å®šPythonç’°å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
    
    - name: ğŸ“¦ å®‰è£ç›¸ä¾å¥—ä»¶
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ• é¡¯ç¤ºç•¶å‰æ™‚é–“
      run: |
        echo "UTCæ™‚é–“: $(date -u)"
        echo "å°ç£æ™‚é–“: $(TZ='Asia/Taipei' date)"
    
    - name: ğŸ“Š çˆ¬å–äº¤æ˜“é‡è³‡æ–™
      env:
        GOOGLE_SHEETS_CREDENTIALS: ${{ secrets.GOOGLE_SHEETS_CREDENTIALS }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        python taifex_crawler.py \
          --date-range today \
          --contracts TX,TE,MTX,ZMX,NQF \
          --identities ALL \
          --data_type TRADING \
          --max_workers 5 \
          --delay 1.0 \
          --check_days 7
    
    - name: ğŸ“ ä¸Šå‚³çˆ¬å–çµæœ
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: trading-data-results
        path: |
          output/*.csv
          output/*.xlsx
          *.log
        retention-days: 30
    
    - name: ğŸ’¬ ç™¼é€é€šçŸ¥ (æˆåŠŸ)
      if: success()
      run: |
        echo "âœ… äº¤æ˜“é‡è³‡æ–™çˆ¬å–æˆåŠŸ - $(TZ='Asia/Taipei' date)"
        echo "ğŸ“Š è³‡æ–™å·²ä¸Šå‚³åˆ°Google Sheetsçš„ã€Œäº¤æ˜“é‡è³‡æ–™ã€åˆ†é "
    
    - name: ğŸ’¬ ç™¼é€é€šçŸ¥ (å¤±æ•—)
      if: failure()
      run: |
        echo "âŒ äº¤æ˜“é‡è³‡æ–™çˆ¬å–å¤±æ•— - $(TZ='Asia/Taipei' date)"
        echo "è«‹æª¢æŸ¥æ—¥èªŒäº†è§£è©³ç´°éŒ¯èª¤ä¿¡æ¯" 