# 🤖 台期所資料自動化爬取系統

## 📋 系統概述

本專案使用GitHub Actions實現台灣期貨交易所資料的自動化爬取，每日定時執行並將結果保存到repository中。

## 🚀 功能特色

- ✅ **每日自動執行**: 台北時間每天早上9:00自動爬取前一個交易日資料
- ✅ **手動觸發**: 支援手動執行，可指定日期範圍和契約
- ✅ **多契約支援**: 支援TX、TE、MTX、ZMX、NQF等期貨契約
- ✅ **失敗通知**: 執行失敗時自動產生通知
- ✅ **週報生成**: 每週自動生成資料統計報告
- ✅ **版本控制**: 所有資料自動提交到Git repository
- ✅ **完全免費**: 使用GitHub Actions免費額度

## 📁 檔案結構

```
📦 專案根目錄
├── 📁 .github/workflows/          # GitHub Actions工作流程
│   ├── 📄 daily_crawler.yml       # 每日爬蟲主要流程
│   ├── 📄 notify_on_failure.yml   # 失敗通知流程
│   └── 📄 weekly_report.yml       # 週報生成流程
├── 📁 output/                     # 爬取結果輸出目錄
├── 📄 taifex_crawler.py           # Python爬蟲主程式
├── 📄 requirements.txt            # Python相依套件
└── 📄 AUTOMATION_README.md        # 本說明文件
```

## ⚙️ 工作流程說明

### 1. 每日爬取 (daily_crawler.yml)

**觸發時機:**
- 自動: 每日台北時間 09:00 (UTC 01:00)
- 手動: 可在GitHub Actions頁面手動觸發

**執行步驟:**
1. 檢出專案程式碼
2. 設定Python 3.9環境
3. 安裝相依套件
4. 執行爬蟲腳本
5. 檢查輸出結果
6. 提交並推送資料到repository

**可設定參數:**
- `date_range`: 日期範圍 (預設: today)
- `contracts`: 契約代碼 (預設: TX,TE,MTX)

### 2. 失敗通知 (notify_on_failure.yml)

當每日爬取失敗時，自動產生失敗報告並在GitHub Actions中顯示警告。

### 3. 週報生成 (weekly_report.yml)

**觸發時機:**
- 自動: 每週日台北時間 18:00 (UTC 10:00)
- 手動: 可在GitHub Actions頁面手動觸發

**功能:**
- 統計本週爬取的檔案數量
- 顯示最新檔案清單
- 計算資料夾大小
- 產生週報並上傳為artifact

## 🛠️ 使用方法

### 1. 初次設定

1. **Fork或下載此專案**到你的GitHub帳號
2. **確保專案為public repository**（私有repository的GitHub Actions使用時間有限制）
3. 檢查`taifex_crawler.py`和`requirements.txt`是否在根目錄

### 2. 手動執行

1. 進入你的GitHub repository
2. 點選**Actions**標籤
3. 選擇**每日台期所資料爬取**工作流程
4. 點選**Run workflow**
5. 設定參數:
   - **日期範圍**: 
     - `today` - 今天
     - `2024-01-15` - 單一日期
     - `2024-01-01,2024-01-31` - 日期範圍
   - **契約代碼**: `TX,TE,MTX` (用逗號分隔)

### 3. 查看結果

執行完成後，資料會保存在`output/`目錄中:
- **CSV檔案**: 原始資料，適合進一步分析
- **Excel檔案**: 格式化資料，適合直接查看
- **執行日誌**: 詳細的執行過程記錄

## 📊 資料輸出格式

### 檔案命名規則
```
taifex_{日期範圍}_{契約}_{身份別}.csv
taifex_{日期範圍}_{契約}_{身份別}.xlsx
```

例如: `taifex_20240115-20240115_TX_TE_MTX_自營商_投信_外資.csv`

### 資料欄位
- 日期
- 契約代碼
- 契約名稱
- 身份別
- 多方交易口數/金額
- 空方交易口數/金額
- 多空淨額交易口數/金額
- 多方未平倉口數/金額
- 空方未平倉口數/金額
- 多空淨額未平倉口數/金額

## 🕐 執行時間表

| 工作流程 | 頻率 | 台北時間 | UTC時間 | 說明 |
|---------|------|----------|---------|------|
| 每日爬取 | 每日 | 09:00 | 01:00 | 避開市場開盤時間 |
| 週報生成 | 每週日 | 18:00 | 10:00 | 週末進行統計 |

## 🔧 進階設定

### 修改執行時間

編輯`.github/workflows/daily_crawler.yml`中的cron表達式:

```yaml
schedule:
  - cron: '0 1 * * *'  # UTC時間，對應台北時間09:00
```

### 修改預設契約

編輯workflow中的預設值:

```yaml
contracts:
  description: '契約代碼 (用逗號分隔，如: TX,TE,MTX)'
  required: false
  default: 'TX,TE'  # 修改這裡
```

### 調整爬蟲參數

修改`taifex_crawler.py`中的預設參數:
- `delay`: 請求間隔時間
- `max_retries`: 最大重試次數
- `max_workers`: 並行工作數

## 📈 監控與維護

### 檢查執行狀態
1. 進入GitHub repository的**Actions**標籤
2. 查看工作流程執行歷史
3. 點選特定執行查看詳細日誌

### 常見問題排解

**Q: 工作流程執行失敗怎麼辦？**
A: 
1. 檢查Actions日誌中的錯誤訊息
2. 確認台期所網站是否正常
3. 檢查是否為非交易日

**Q: 沒有爬取到資料？**
A: 
1. 確認日期是否為交易日
2. 檢查契約代碼是否正確
3. 查看爬蟲日誌中的詳細訊息

**Q: GitHub Actions執行時間不夠用？**
A: 
- GitHub免費帳號每月有2000分鐘額度
- 可考慮減少爬取頻率或契約數量
- 公開repository的Actions使用不計費

## 💡 最佳實踐

1. **定期檢查**: 每週檢查一次執行狀況
2. **備份重要資料**: 將output目錄定期備份到其他地方
3. **監控repository大小**: GitHub有repository大小限制，定期清理舊檔案
4. **遵守爬取規範**: 適當設定請求間隔，避免對目標網站造成負擔

## 📞 技術支援

如有問題或建議，請：
1. 查看GitHub Issues
2. 檢查爬蟲執行日誌
3. 參考台期所官網的資料格式變更

---

**📝 注意事項:**
- 本工具僅供學習和研究使用
- 請遵守台灣期貨交易所的使用條款
- 資料準確性請以官方網站為準
- 使用前請確保符合相關法規要求 